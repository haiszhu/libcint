function f = cgtofunc(x,y,z)
% implement cgto, which calls libcint, libcgto, np_helper, etc...
%
% 07/28/24 Hai

% respect the shape of input variables
nd = 24;
[n1,n2,n3] = size(x);
f = zeros([n1 n2 n3 nd]); % need to be changed later

persistent ngrids shls_slice ao_loc non0tab atm bas env natm nbas nao;
if isempty(ngrids)
  ngrids = 1; 
  shls_slice = [0, 11];
  ao_loc = [0, 2, 3, 6, 9, 14, 15, 16, 19, 20, 21, 24];
  % xyz = [0.0, 1.0, 1.0];  
  non0tab = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
  atm = [
    8, 20, 1, 23, 0, 0,...
    1, 24, 1, 27, 0, 0,...
    1, 28, 1, 31, 0, 0];
  bas = [
    0, 0, 8, 2, 0, 42, 50, 0,...
    0, 0, 1, 1, 0, 66, 67, 0,...
    0, 1, 3, 1, 0, 68, 71, 0,...
    0, 1, 1, 1, 0, 74, 75, 0,...
    0, 2, 1, 1, 0, 76, 77, 0,...
    1, 0, 3, 1, 0, 32, 35, 0,...
    1, 0, 1, 1, 0, 38, 39, 0,...
    1, 1, 1, 1, 0, 40, 41, 0,...
    2, 0, 3, 1, 0, 32, 35, 0,...
    2, 0, 1, 1, 0, 38, 39, 0,...
    2, 1, 1, 1, 0, 40, 41, 0];
  env = [
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,...
    0.00000000e+00, -1.43052268e+00,  1.10926924e+00,  0.00000000e+00,...
    0.00000000e+00,  1.43052268e+00,  1.10926924e+00,  0.00000000e+00,...
    1.30100000e+01,  1.96200000e+00,  4.44600000e-01,  5.79764064e-01,...
    9.83419580e-01,  1.11930215e+00,  1.22000000e-01,  5.21536727e-01,...
    7.27000000e-01,  1.95840453e+00,  1.17200000e+04,  1.75900000e+03,...
    4.00800000e+02,  1.13700000e+02,  3.70300000e+01,  1.32700000e+01,...
    5.02500000e+00,  1.01300000e+00,  2.01954000e+00,  3.75176051e+00,...
    6.29675240e+00,  9.21467523e+00,  1.07298897e+01,  7.87818279e+00,...
    2.29637501e+00,  3.94147511e-02, -8.94856161e-01, -1.70329657e+00,...
   -2.78735973e+00, -4.44591655e+00, -5.28622990e+00, -5.71024998e+00,...
   -1.94898449e+00,  2.79438767e+00,  3.02300000e-01,  1.03001520e+00,...
    1.77000000e+01,  3.85400000e+00,  1.04600000e+00,  6.63856461e+00,...
    5.25433167e+00,  2.28748174e+00,  2.75300000e-01,  5.81757722e-01,...
    1.18500000e+00,  3.51185438e+00
  ];
  natm = numel(atm)/6;
  nbas = numel(bas)/8;
  nao = ao_loc(shls_slice(2)+1) - ao_loc(shls_slice(1)+1);
end

% nx,ny,nz,nd
for ix = 1:n1
  for iy = 1:n2
    for iz = 1:n3
      xyz = [x(ix,iy,iz); y(ix,iy,iz); z(ix,iy,iz)];
      fi = zeros(nd,1);
      fi = GTOval_sph_mwrap_mex(ngrids, shls_slice, ao_loc, fi, xyz, non0tab, atm, natm, bas, nbas, env);
      f(ix,iy,iz,:) = fi;
    end
  end
end

end