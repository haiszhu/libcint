function f = cgtofunc_h2o_dimer_ccpvdz(x,y,z)
% implement cgto, which calls libcint, libcgto, np_helper, etc...
% 
%
% h2o_dimer, ccpvdz
% geom='''
%         O  -1.551007  -0.114520   0.000000
%         H  -1.934259   0.762503   0.000000
%         H  -0.599677   0.040712   0.000000
%         O   1.350625   0.111469   0.000000
%         H   1.680398  -0.373741  -0.758561
%         H   1.680398  -0.373741   0.758561
%         '''
% 
% mol_h2o_dimer = gto.M(
%         verbose=7, 
%         atom=geom, 
%         basis='ccpvdz')
%
% use parameters from pyscf/pyscf/gto/eval_gto.py
% 
%
% 01/22/25 Hai

% respect the shape of input variables
nd = 48;
[n1,n2,n3] = size(x);
f = zeros([n1 n2 n3 nd]); % need to be changed later

persistent ngrids shls_slice ao_loc non0tab atm bas env natm nbas nao triuidx triflag;
if isempty(ngrids)
  % ngrids = 1; 
  shls_slice = [0, 22];
  ao_loc = [ 0,  2,  3,  6,  9, 14, 15, 16, 19, 20, 21, 24, 26, 27, 30, 33, 38, 39, 40, 43, 44, 45, 48];
  non0tab = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
  atm = [
    8, 20,  1, 23,  0,  0,...
    1, 24,  1, 27,  0,  0,...
    1, 28,  1, 31,  0,  0,...
    8, 32,  1, 35,  0,  0,...
    1, 36,  1, 39,  0,  0,...
    1, 40,  1, 43,  0,  0];
  bas = [
    0,  0,  8,  2,  0, 54, 62,  0,...
    0,  0,  1,  1,  0, 78, 79,  0,...
    0,  1,  3,  1,  0, 80, 83,  0,...
    0,  1,  1,  1,  0, 86, 87,  0,...
    0,  2,  1,  1,  0, 88, 89,  0,...
    1,  0,  3,  1,  0, 44, 47,  0,...
    1,  0,  1,  1,  0, 50, 51,  0,...
    1,  1,  1,  1,  0, 52, 53,  0,...
    2,  0,  3,  1,  0, 44, 47,  0,...
    2,  0,  1,  1,  0, 50, 51,  0,...
    2,  1,  1,  1,  0, 52, 53,  0,...
    3,  0,  8,  2,  0, 54, 62,  0,...
    3,  0,  1,  1,  0, 78, 79,  0,...
    3,  1,  3,  1,  0, 80, 83,  0,...
    3,  1,  1,  1,  0, 86, 87,  0,...
    3,  2,  1,  1,  0, 88, 89,  0,...
    4,  0,  3,  1,  0, 44, 47,  0,...
    4,  0,  1,  1,  0, 50, 51,  0,...
    4,  1,  1,  1,  0, 52, 53,  0,...
    5,  0,  3,  1,  0, 44, 47,  0,...
    5,  0,  1,  1,  0, 50, 51,  0,...
    5,  1,  1,  1,  0, 52, 53,  0];
  env = [
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00, ...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00, ...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00, ...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00, ...
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00, ...
   -2.93097845e+00, -2.16411436e-01,  0.00000000e+00,  0.00000000e+00, ...
   -3.65521976e+00,  1.44092184e+00,  0.00000000e+00,  0.00000000e+00, ...
   -1.13322529e+00,  7.69345300e-02,  0.00000000e+00,  0.00000000e+00, ...
    2.55231135e+00,  2.10645881e-01,  0.00000000e+00,  0.00000000e+00, ...
    3.17549200e+00, -7.06268132e-01, -1.43347254e+00,  0.00000000e+00, ...
    3.17549200e+00, -7.06268132e-01,  1.43347254e+00,  0.00000000e+00, ...
    1.30100000e+01,  1.96200000e+00,  4.44600000e-01,  5.79764064e-01, ...
    9.83419580e-01,  1.11930215e+00,  1.22000000e-01,  5.21536727e-01, ...
    7.27000000e-01,  1.95840453e+00,  1.17200000e+04,  1.75900000e+03, ...
    4.00800000e+02,  1.13700000e+02,  3.70300000e+01,  1.32700000e+01, ...
    5.02500000e+00,  1.01300000e+00,  2.01954000e+00,  3.75176051e+00, ...
    6.29675240e+00,  9.21467523e+00,  1.07298897e+01,  7.87818279e+00, ...
    2.29637501e+00,  3.94147511e-02, -8.94856161e-01, -1.70329657e+00, ...
   -2.78735973e+00, -4.44591655e+00, -5.28622990e+00, -5.71024998e+00, ...
   -1.94898449e+00,  2.79438767e+00,  3.02300000e-01,  1.03001520e+00, ...
    1.77000000e+01,  3.85400000e+00,  1.04600000e+00,  6.63856461e+00, ...
    5.25433167e+00,  2.28748174e+00,  2.75300000e-01,  5.81757722e-01, ...
    1.18500000e+00,  3.51185438e+00];
  natm = numel(atm)/6;
  nbas = numel(bas)/8;
  nao = ao_loc(shls_slice(2)+1) - ao_loc(shls_slice(1)+1);
end

if 1 % 2025 version
  ngrids = n1*n2*n3;
  xyz = [x(:), y(:), z(:)]';
  xyz = xyz(:);
  fi = zeros([nd ngrids]); 
  fi = GTOval_h2o_dimer_ccpvdz_mwrap_mex(ngrids, shls_slice, ao_loc, fi, xyz, non0tab, atm, natm, bas, nbas, env);
  % fi = GTOval_sph_generic_mwrap_mex(ngrids, shls_slice, ao_loc, fi, xyz, non0tab, atm, natm, bas, nbas, env);
  f = reshape(fi,[nd ngrids])';
  f = reshape(f,[n1 n2 n3 nd]);
end
